# メッセージ指向ゲーム記述言語「司エンジン（Tsukasa Engine）」

#概要

* 司エンジンはRuby上で駆動するゲームフレームワークです。バックエンドにDirectX専用ゲームライブラリDXRubyを使用しています。
* 内部ＤＳＬによる記述言語「司スクリプト」と、その言語を解釈する「司エンジン」から構成されています。
* また、ノベルゲーム制作用に、吉里吉里ライクなtksという記述形式を用意しています。tksは内部的に司スクリプトに変換されます。また、tks内に直接司スクリプトを記述できます。

* 現在はβリリース中で、毎日のようにインターフェイスが変更されています。クリスマスごろには１ｓｔリリースしたいと考えています。

# 内部メカニズムの特徴

* ゲームで用いる全てのオブジェクトをみなし、単一のツリーに連結させている
    * 画像、サウンドはもちろん、テキストウィンドウ内の文字一個にいたるまでオブジェクトとして管理しています。
    * これによって、ゲームのあらゆる要素に対して一貫した設計コンセプトを実現します。
* 全てのオブジェクトをＶＭ（計算機）とみなし、ツリーの上位からメッセージを送信して駆動する。
    * 上位から送信されたメッセージは各オブジェクト内にスタックされ、実行されます。
    * 各メッセージは処理を行ったのち、自律的に自身を削除するか、次フレームに再実行するかを判断します。
    * 同フレーム中に複数の上位オブジェクトから同一のオブジェクトに対しメッセージが送信された場合、その全てがスタックされ、同フレーム中に処理されます。
    * メッセージには制御構文も含められるため、プログラムブロックをまるごと送信できます。Smalltalkのイメージが近いかもしれません。
    * これらの挙動により、とかく状態遷移機械としての実装が複雑になりがちなゲームプログラミングのオブジェクトの実装効率を上げています。
* 全てのオブジェクトは疑似マルチスレッド的に駆動する。
    * それぞれのオブジェクトは受け取ったメッセージ（≒プログラムブロック）を非同期に処理するので、ゲームのように複雑な並列処理が必要とされるプログラムを、平坦に記述できます。

#デメリット

* 現状ではノベルゲームの開発に特化しています。将来的には汎用ゲームフレームワークにしたいと考えています。
* 現状では極めて富豪的に実装を進めており、速度パフォーマンスを考慮していません。またこれは将来的にも解決しないかもしれません。
* 現状ではexeファイルを生成することが単体ではできません。ocraなどを使ってください。
* 現状ではWindows(≒DirectX)専用です。

#ドキュメント

　司エンジンに関するドキュメントについては、下記の各サイトを参照してください。

* DXRuby Advent Calendar 2015 ３日目：汎用ゲームフレームワーク（を目指す）司エンジンの紹介
    * http://d.hatena.ne.jp/t_tutiya/20151202/1449068891
* 司エンジン解説本第１部サンプル（１２月２日版）
    * http://someiyoshino.main.jp/file/1218_tsukasa_engine_book_sample_chap1.pdf
* 司エンジン：司スクリプト記法解説
    * http://d.hatena.ne.jp/t_tutiya/20151103/1446536107
* 司エンジン：tksスクリプト記法解説
    * http://d.hatena.ne.jp/t_tutiya/20151104/1446606281
* リファレンスマニュアル
    * https://github.com/t-tutiya/tsukasa/wiki

#その他の資料

## コードサンプル
　土屋のブログでコードのサンプルと解説を載せているのですが、すみません、これらはどれも内容が古く、1stリリース版では動かない物が多数あります。script/sampleフォルダに入っているサンプルコードの方はアップデートされているので、最新仕様についてはそちらを参照してください。

土屋つかさのテクノロジーは今か無しか
http://d.hatena.ne.jp/t_tutiya/

## キーコード定数
　キー入力判定時に使用するキーコード定数はDXRubyと同じです。

DXRuby キーコード定数
http://mirichi.github.io/dxruby-doc/api/constant_keycode.html

## フォルダ構成
　司エンジン開発フォルダルート直下のフォルダとファイル構成を簡単に解説しておきます。
* system 司エンジンのソースコードが格納されています。
* default 初期値を設定するconfig.rb／デフォルトのスクリプトを格納するdefault_script.rbなどが格納されています。
* script 司/tksスクリプトを配置するフォルダです。このフォルダのfirst.rbが最初に実行されます。
* resource サンプルで使うリソースファイルが入っています。
    * githubからインストールする場合は、下記ファイルを直接ダウンロードし、展開後に配置してください。
* datastore データストアを保存するフォルダです。初期状態では空です。
    * githubからインストールする場合はこのフォルダが存在しないので、手動で空フォルダを作成してください。
* main.rb 実行スクリプト。これ自体は司エンジンには含まれません。
* readme.rd 簡易ドキュメント
