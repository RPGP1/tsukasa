# メッセージ指向ゲーム記述言語「司エンジン（Tsukasa Engine）」

# 概要

* 司エンジンはメッセージ指向ゲーム記述言語「司スクリプト」の実装系です。rubyの内部ＤＳＬとして実装され、開発環境を含むフレームワークとして構成されています。
* Ruby用DirectXゲームライブラリDXRuby上で動作しています。Windows専用です。
* また、ノベルゲームの開発に特化した「tksスクリプト」も使用できます。tksスクリプトは内部で司スクリプトに変換され、ユーザーは必要に応じてシームレスに扱うことができます。

# 内部メカニズムの特徴

* ゲームで用いる全てのオブジェクトをみなし、単一のツリーに連結させている
    * 画像、サウンドはもちろん、テキストウィンドウ内の文字一個にいたるまでオブジェクトとして管理しています。
    * これによって、ゲームのあらゆる要素に対して一貫した設計コンセプトを実現します。
* 全てのオブジェクトをＶＭ（計算機）とみなし、ツリーの上位からメッセージを送信して駆動する。
    * 上位から送信されたメッセージは各オブジェクト内にスタックされ、実行されます。
    * 各メッセージは処理を行ったのち、自律的に自身を削除するか、次フレームに再実行するかを判断します。
    * 同フレーム中に複数の上位オブジェクトから同一のオブジェクトに対しメッセージが送信された場合、その全てがスタックされ、同フレーム中に処理されます。
    * メッセージには制御構文も含められるため、プログラムブロックをまるごと送信できます。
    * これらの挙動により、とかく状態遷移機械としての実装が複雑になりがちなゲームプログラミングのオブジェクトの実装効率の向上を狙っています。
* 全てのオブジェクトは疑似マルチスレッド的に駆動する。
    * それぞれのオブジェクトは受け取ったメッセージ（≒プログラムブロック）を非同期に処理するので、ゲームのように複雑な並列処理が必要とされるプログラムを、平坦に記述できます。

#ドキュメント

　司エンジンに関するドキュメントについては、下記の各サイトを参照してください。

* 司エンジン：導入手順
    * [準備中]
* 司エンジン：司スクリプト記法解説
    * http://d.hatena.ne.jp/t_tutiya/20151103/1446536107
* 司エンジン：tksスクリプト記法解説
    * http://d.hatena.ne.jp/t_tutiya/20151104/1446606281
* リファレンスマニュアル
    * https://github.com/t-tutiya/tsukasa/wiki
* サンプルコード
    * [準備中。script/sampleフォルダに入っているサンプルコードを参照してください]

#その他の資料

##司エンジンの設計コンセプト

　司エンジンは「既存のゲーム開発そのもの」を再定義するために土屋つかさが進めている個人プロジェクトです。下記記事で紹介しています。

DXRuby Advent Calendar 2015 ３日目：汎用ゲームフレームワーク（を目指す）司エンジンの紹介
http://d.hatena.ne.jp/t_tutiya/20151202/1449068891

　上記記事にもリンクしていますが、下記のＰＤＦでは司エンジンが問題領域としている課題について、より専門的な議論を展開しています。
司エンジン解説本第１部サンプル（１２月２日版）
http://someiyoshino.main.jp/file/1218_tsukasa_engine_book_sample_chap1.pdf

## キーコード定数
　キー入力判定時に使用するキーコード定数はDXRubyと同じです。

DXRuby キーコード定数
http://mirichi.github.io/dxruby-doc/api/constant_keycode.html

## フォルダ構成
　司エンジン開発フォルダルート直下のフォルダとファイル構成を簡単に解説しておきます。
* system 司エンジンのソースコードが格納されています。
* default 初期値を設定するconfig.rb／デフォルトのスクリプトを格納するdefault_script.rbなどが格納されています。
* script 司/tksスクリプトを配置するフォルダです。このフォルダのfirst.rbが最初に実行されます。
* resource サンプルで使うリソースファイルが入っています。
    * githubからインストールする場合は、下記ファイルを直接ダウンロードし、展開後に配置してください。
* datastore データストアを保存するフォルダです。初期状態では空です。
    * githubからインストールする場合はこのフォルダが存在しないので、手動で空フォルダを作成してください。
* main.rb 実行スクリプト。これ自体は司エンジンには含まれません。
* readme.rd 簡易ドキュメント
